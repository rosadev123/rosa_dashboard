---
title: "FishFORWRD Database"
format: 
  dashboard:
    embed-resources: true
---

```{r echo=FALSE, message=FALSE, msg = F, warning = F, error = F}
library(gauntlet)
library(magrittr)
library(targets)
library(tidyverse, quietly = TRUE)

package_load_q = purrr::quietly(gauntlet::package_load)

tmp = c("tibble", "tidyverse", "magrittr","gauntlet"
        ,"gauntletReactable", "reactable", "reactablefmtr"
        ,"crosstalk", "plotly"
        ,"bslib","bsicons", "htmltools", "shiny") %>% 
  package_load_q()
```

```{r}
# setwd(here::here())
table_height = 500

# source(here::here("code/helpers_skankey.R"))
```

```{css}
.navbar {
background-color: #016FB1;
}

.cardSpecBig {
text-align: center;
font-size: large;
}

.cardcenter {
text-align: center;
}

.cardSpecSmall {
text-align: center;
font-size: small;
}
```

<!-- ```{js} -->

<!-- function filter_default(){ -->

<!--   document.getElementById("id_tble_project_summary_proj").getElementsByClassName("selectized")[0].selectize.setValue("Ex-1",false) -->

<!-- } -->

<!-- $(document).ready(filter_default); -->

<!-- ``` -->

```{r}
setwd(here::here())
tar_load_everything()

# tar_load(data_current_pro)
# tar_load(data_needed_pro)
# tar_load(viz_prj_timeline)
# tar_load(viz_proj_location_tree)
# tar_load(viz_proj_location_tree_needs)
# tar_load(viz_tble_crrnt_proj_shrt)
# tar_load(viz_tble_dcntr_acc)
# tar_load(viz_tble_dcntr_current)
# tar_load(viz_tble_dcntr_def)
# tar_load(viz_tble_dcntr_need)
# tar_load(viz_tble_dcntr_ref)
# tar_load(viz_tble_needs_proj_shrt_test)
# tar_load(viz_tble_project_summary)
# 
# tar_load(viz_viz_unaddressed_needs)
# tar_load(viz_tble_need_anmlgrp)
# tar_load(viz_tble_needs_proj_shrt)
# tar_load(viz_tble_agg_addrssd_gap)


```

# Welcome Page

## Row {height = "15%"}

::: cardSpecBig
Welcome to the <strong>FishFORWRD Database</strong>\
Developed in Partnership by <strong>ROSA</strong>, <strong>Attentive Energy</strong>, and <strong>WSP</strong>\
![](../docs/rosa_logo.jpg){width="10%"} ![](../docs/ae_log_sm.png){width="10%"} ![](../docs/img-png-wsp-black.png){width="5%"}
:::

## Row {height="70%"}

### Column {width="60%"}

```{r}
bslib::card(
  bslib::card_body(
    shiny::markdown("
  <strong>Purpose of this Database</strong><br>
FishFORWRD is a catalog of all East Coast research, monitoring efforts, and stated research needs for offshore wind, fish, and fisheries.   
This database differentiates ongoing projects funded to examine offshore wind interactions from other programs that provide valuable data, but which haven't necessarily been designed to assess offshore wind impacts.    
The objective of FishFORWRD is to increase awareness of ongoing work, avoid duplication of efforts, and create a common understanding of research needs. This tool is meant for research funders, fisheries and offshore wind researchers, offshore wind developers, and the public.

<strong>How to use this Dashboard</strong><br>
This dashboard is comprised of a number of tabs, each with their own purpose and functionality with features to help you explore page content or visuals. All tables and plots are interactive and can be manipulated via the mouse.  
Use this dashboard to explore completed and ongoing research and monitoring efforts, explore research needs expressed by our community, understand which research needs have been funded and are under exploration, and which research gaps still remain. Filter projects and research needs by location, research category, methodology used, funder and more.

<strong>Explanation of Tabs</strong>

<strong>[Current Projects:](#current-projects)</strong> : View completed and ongoing projects with high level attributes. This includes funded research and implemented offshore wind developer Fisheries Monitoring Plans.

<strong>[Research Needs Gap Analysis:](#research-needs)</strong> Identify research gaps and explored unaddressed needs.

<strong>[Explored Research Needs:](#research-needs)</strong> Analyze which research needs have been funded through which existing projects.

<strong>[Database Center:](#database-center)</strong> Interact with raw data and download database directly to your local computer.

<strong>[Submit Project:](#submit-project)</strong> Submit information to update and improve FishFORWRD.
")
  )
)
```

### Column {width="15%"}

```{r}
bslib::value_box(
  title = "Total Project Count"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_current_pro)
  ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research Categories"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$research_category))
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Identified Needs"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_needed_pro)
    ,full_screen = F
)
```

### Column {width="15%"}

```{r}
bslib::value_box(
  title = "% Complete or Near Complete"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_current_pro[data_current_pro$status_of_research == "Complete", ])/nrow(data_current_pro), 2)) %>%
    paste0(., "%")
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research \nLocations"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$location))
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "% Not Addressed"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_needed_pro[data_needed_pro$data_gap_analysis_score == "Not Addressed", ])/nrow(data_needed_pro), 2)) %>%
    paste0(., "%")
    ,full_screen = F
)
```

## Row {height="10%"}

::: cardSpecSmall
For support, issue reporting, or for features you'd like to see - contact: info@rosascience.org

This dashboard was last published: `r Sys.Date()` 
:::

# Col Sub Rows w/Tab Adj Hght {orientation="columns" scrolling="false"}

## Column {width="60%"}

### Row {height="8%"}
```{r}
bslib::card(
  # height="100px"
  bslib::card_body(
    shiny::markdown("Find full project information in Database Center")))
```

### Row 
```{r}
#| title: "Research Need Snapshot (by category)"
viz_tble_crrnt_proj_shrt
```

## Column {.tabset width="40%"}
```{r}
#| title: "No. of Projects by Location"
viz_proj_location_tree
```

```{r}
#| title: "Project Timelines"
# crosstalk::bscols(
#   widths = c(12)
viz_prj_timeline
#   ,"Note: This plot on displays projects with a valid start and end date."
# )
```
